<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>html downloader</title>

  <!-- Google Font (optional, looks nicer) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-1: #071126;
      --bg-2: #08172a;
      --card: rgba(255,255,255,0.04);
      --muted: #9fb0c6;
      --glass: rgba(255,255,255,0.03);
      --accent-1: #7c3aed;
      --accent-2: #06b6d4;
      --accent-3: #60a5fa;
      --glass-border: rgba(255,255,255,0.06);
      --glass-2: rgba(255,255,255,0.02);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 500px at 10% 10%, rgba(124,58,237,0.12), transparent 8%), linear-gradient(180deg,var(--bg-1),var(--bg-2));font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:#e9f2ff}
    a{color:inherit;text-decoration:none}
    .container{max-width:1180px;margin:28px auto;padding:20px;display:grid;grid-template-columns:1fr 420px;gap:20px}

    header{grid-column:1/-1;display:flex;align-items:center;gap:18px}
    .logo {
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));
      display:flex;align-items:center;justify-content:center;box-shadow:0 8px 30px rgba(6,182,212,0.08), inset 0 -6px 18px rgba(255,255,255,0.06);
      font-weight:800;font-size:18px;color:white;
    }
    h1{margin:0;font-size:18px;letter-spacing:-0.2px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;padding:16px;border:1px solid var(--glass-border);backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px rgba(4,10,20,0.6);
    }

    label{display:block;margin-top:12px;font-size:13px;color:var(--muted)}
    input[type="text"], textarea, select {
      width:100%;padding:12px;border-radius:10px;border:1px solid var(--glass-2);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));color:inherit;font-size:14px;outline:none;
    }
    textarea{min-height:120px;resize:vertical}
    .files-list{margin-top:6px;font-size:13px;color:var(--muted);min-height:20px}

    /* Buttons + shiny hover effect */
    .btn {
      position:relative;
      display:inline-block;
      padding:10px 14px;border-radius:12px;border:none;font-weight:700;background:linear-gradient(90deg,var(--accent-1),var(--accent-3));color:white;cursor:pointer;
      overflow:hidden;box-shadow:0 8px 28px rgba(124,58,237,0.14);
      transition:transform .18s ease, box-shadow .18s ease;
    }
    .btn:active{transform:translateY(1px);}

    /* ghost button style */
    .btn.ghost{
      background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04);box-shadow:none;padding:9px 12px;
    }

    /* shiny streak using pseudo element */
    .btn::after{
      content:"";
      position:absolute;top:-40%;left:-30%;
      width:40%;height:180%;
      background:linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.35) 50%, rgba(255,255,255,0) 100%);
      transform:rotate(18deg) translateX(-120%);
      transition:transform .9s cubic-bezier(.2,.9,.2,1);
      pointer-events:none;opacity:0.95;
      filter: blur(10px);
    }
    /* move streak across on hover */
    .btn:hover::after{
      transform:rotate(18deg) translateX(260%);
    }
    /* subtle glow on hover */
    .btn:hover{box-shadow:0 16px 40px rgba(99,102,241,0.18), 0 2px 6px rgba(6,182,212,0.06);transform:translateY(-2px)}

    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center}
    .muted{color:var(--muted);font-size:13px}

    /* Preview frame */
    iframe.preview{width:100%;height:360px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);background:white;margin-top:8px}

    /* responsive */
    @media (max-width:980px){
      .container{grid-template-columns:1fr; padding:14px}
      iframe.preview{height:320px}
    }

    /* small helper */
    .row{display:flex;gap:8px;align-items:center}
    .small-note{font-size:12px;color:var(--muted);margin-top:6px}
    .file-pill{display:inline-block;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:6px 8px;border-radius:10px;font-size:13px;border:1px solid rgba(255,255,255,0.02);margin-right:6px;margin-top:6px;color:var(--muted)}
    .top-actions{display:flex;gap:8px;align-items:center}
    .brandline{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">HD</div>
      <div>
        <h1>HTML Download Builder — Shiny Edition</h1>
        <p class="lead">Inline CSS / JS / images, preview live, and download a single self-contained HTML file. Pretty & practical.</p>
      </div>
    </header>

    <!-- Left column: editor -->
    <section class="card" id="left">
      <div class="top-actions" style="justify-content:space-between;align-items:center">
        <div class="brandline">Build a self-contained page</div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="buildBtn" class="btn">Build</button>
          <button id="previewBtn" class="btn ghost">Preview</button>
        </div>
      </div>

      <label>Page title</label>
      <input id="pageTitle" type="text" placeholder="My cool page" value="Hello from my site">

      <label>Body content (HTML allowed)</label>
      <textarea id="bodyHtml" placeholder="<h1>Hello</h1><p>My content...</p>"><h1>Hello from my site</h1>
<p>This HTML was generated dynamically and packaged with inline CSS & images.</p></textarea>

      <label>Or paste full HTML instead (overrides title/body)</label>
      <textarea id="fullHtml" placeholder="Paste full HTML here (optional)"></textarea>
      <small class="small-note">If you paste a full HTML doc, it'll be used as-is but uploaded assets can still be inlined.</small>

      <label>Upload CSS files to inline</label>
      <input id="cssFiles" type="file" accept=".css" multiple />
      <div class="files-list" id="cssList">No CSS uploaded</div>

      <label>Upload JS files to inline</label>
      <input id="jsFiles" type="file" accept=".js" multiple />
      <div class="files-list" id="jsList">No JS uploaded</div>

      <label>Upload images to embed (PNG, JPG, GIF, SVG)</label>
      <input id="imgFiles" type="file" accept="image/*" multiple />
      <div class="files-list" id="imgList">No images uploaded</div>

      <div class="controls">
        <button id="downloadBtn" class="btn">Download HTML</button>
        <button id="clearBtn" class="btn ghost">Clear uploads</button>
        <button id="exportSource" class="btn ghost">Export source</button>
        <div style="margin-left:auto" class="muted">Tip: inline CSS/images for a fully offline file</div>
      </div>
    </section>

    <!-- Right column: preview + quick download -->
    <aside class="card" id="right">
      <label>Preview</label>
      <iframe id="previewFrame" class="preview" sandbox="allow-same-origin allow-scripts"></iframe>

      <label style="margin-top:10px">Quick static file (same-origin)</label>
      <div class="row" style="margin-top:6px">
        <input id="staticPath" type="text" placeholder="/files/myfile.html" value="/files/myfile.html">
        <a id="staticAnchor" class="btn ghost" style="display:inline-block;padding:8px 12px;border-radius:10px" href="/files/myfile.html" download>Download static</a>
      </div>
      <div class="small-note">Anchor download works best for same-origin files. Otherwise use Build → Download.</div>
    </aside>

    <div class="card" style="grid-column:1/-1;display:flex;justify-content:space-between;align-items:center">
      <div class="muted">Made with love — embeds CSS/JS/images so the downloaded .html is self-contained.</div>
      <div style="display:flex;gap:8px;align-items:center">
        <span class="muted">Want a different accent?</span>
        <button id="accentBtn" class="btn ghost">Swap accent</button>
      </div>
    </div>
  </div>

  <script>
    // --- utilities ---
    const readFileAsText = (file) => new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = rej;
      r.readAsText(file);
    });
    const readFileAsDataURL = (file) => new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });

    // --- DOM refs ---
    const pageTitle = document.getElementById('pageTitle');
    const bodyHtml = document.getElementById('bodyHtml');
    const fullHtml = document.getElementById('fullHtml');
    const cssFiles = document.getElementById('cssFiles');
    const jsFiles = document.getElementById('jsFiles');
    const imgFiles = document.getElementById('imgFiles');
    const cssList = document.getElementById('cssList');
    const jsList = document.getElementById('jsList');
    const imgList = document.getElementById('imgList');
    const buildBtn = document.getElementById('buildBtn');
    const previewBtn = document.getElementById('previewBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const previewFrame = document.getElementById('previewFrame');
    const staticPath = document.getElementById('staticPath');
    const staticAnchor = document.getElementById('staticAnchor');
    const clearBtn = document.getElementById('clearBtn');
    const exportSource = document.getElementById('exportSource');
    const accentBtn = document.getElementById('accentBtn');

    // state
    let uploadedCSS = [];
    let uploadedJS = [];
    let uploadedImages = []; // {name, dataUrl}

    function updateFileLists(){
      cssList.innerHTML = uploadedCSS.length ? uploadedCSS.map(f=>`<span class="file-pill">${f.name}</span>`).join('') : 'No CSS uploaded';
      jsList.innerHTML = uploadedJS.length ? uploadedJS.map(f=>`<span class="file-pill">${f.name}</span>`).join('') : 'No JS uploaded';
      imgList.innerHTML = uploadedImages.length ? uploadedImages.map(f=>`<span class="file-pill">${f.name}</span>`).join('') : 'No images uploaded';
    }

    cssFiles.addEventListener('change', async (e) => {
      const files = Array.from(e.target.files || []);
      for (const f of files) {
        try {
          const text = await readFileAsText(f);
          uploadedCSS.push({ name: f.name, text });
        } catch (err) { console.error(err) }
      }
      updateFileLists(); e.target.value = '';
    });

    jsFiles.addEventListener('change', async (e) => {
      const files = Array.from(e.target.files || []);
      for (const f of files) {
        try {
          const text = await readFileAsText(f);
          uploadedJS.push({ name: f.name, text });
        } catch (err) { console.error(err) }
      }
      updateFileLists(); e.target.value = '';
    });

    imgFiles.addEventListener('change', async (e) => {
      const files = Array.from(e.target.files || []);
      for (const f of files) {
        try {
          const dataUrl = await readFileAsDataURL(f);
          uploadedImages.push({ name: f.name, dataUrl });
        } catch (err) { console.error(err) }
      }
      updateFileLists(); e.target.value = '';
    });

    clearBtn.addEventListener('click', () => {
      uploadedCSS = []; uploadedJS = []; uploadedImages = []; updateFileLists();
    });

    staticPath.addEventListener('input', () => {
      staticAnchor.href = staticPath.value || '#';
      staticAnchor.setAttribute('download', staticPath.value.split('/').pop() || 'file.html');
    });

    // Build HTML (inject inlined assets)
    async function buildHtmlString() {
      const userFull = fullHtml.value.trim();
      const headInject = buildHeadInjection();
      const scriptsInject = buildScriptsInjection();

      if (userFull) {
        let doc = userFull;
        if (doc.includes('</head>')) {
          doc = doc.replace('</head>', headInject + '\n</head>');
        } else {
          doc = `<!doctype html><html><head>${headInject}</head><body>${doc}</body></html>`;
        }
        // inject scripts before </body>
        if (doc.includes('</body>')) {
          doc = doc.replace('</body>', scriptsInject + '\n</body>');
        } else {
          doc += scriptsInject;
        }
        return doc;
      }

      const title = escapeHtml(pageTitle.value || 'Untitled');
      const body = bodyHtml.value || '';

      const doc = `<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${title}</title>
${headInject}
</head>
<body>
${body}
${scriptsInject}
</body>
</html>`;
      return doc;
    }

    function buildHeadInjection(){
      let styleBlock = '';
      for (const css of uploadedCSS) {
        styleBlock += `/* ${css.name} */\n` + css.text + '\n';
      }
      // Basic helpful CSS to ensure body has margin reset in generated file
      const minimalReset = `html,body{margin:0;padding:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;}`;
      if (styleBlock.trim() || minimalReset) {
        return `<style>\n${minimalReset}\n${styleBlock}\n</style>`;
      }
      return '';
    }

    function buildScriptsInjection(){
      let scriptBlock = '';
      for (const js of uploadedJS) {
        scriptBlock += `/* ${js.name} */\n` + js.text + '\n';
      }
      if (uploadedImages.length) {
        const mappings = uploadedImages.map(img => `  "${img.name}": "${img.dataUrl}"`).join(',\n');
        scriptBlock = `window.INLINED_IMAGES = {\n${mappings}\n};\n` + scriptBlock;
      }
      if (scriptBlock.trim()) return `<script>\n${scriptBlock}\n<\/script>`;
      return '';
    }

    function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;') }

    // Build + preview
    buildBtn.addEventListener('click', async () => {
      try {
        const doc = await buildHtmlString();
        const blob = new Blob([doc], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        previewFrame.src = url;
        previewFrame._lastBuild = { doc, url };
      } catch (err) {
        console.error(err); alert('Error building HTML: ' + err.message);
      }
    });

    previewBtn.addEventListener('click', async () => {
      if (previewFrame._lastBuild && previewFrame._lastBuild.url) {
        previewFrame.src = previewFrame._lastBuild.url;
      } else {
        buildBtn.click();
      }
    });

    downloadBtn.addEventListener('click', async () => {
      try {
        let doc;
        if (previewFrame._lastBuild && previewFrame._lastBuild.doc) doc = previewFrame._lastBuild.doc;
        else doc = await buildHtmlString();

        const filename = (pageTitle.value || 'page').toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,'') || 'download';
        triggerDownload(`${filename}.html`, doc);
      } catch (err) { console.error(err); alert('Download failed: ' + err.message); }
    });

    exportSource.addEventListener('click', async () => {
      const doc = await buildHtmlString();
      console.log('=== Generated HTML start ===');
      console.log(doc);
      console.log('=== Generated HTML end ===');
      alert('Source exported to console.');
    });

    function triggerDownload(filename, content){
      const blob = new Blob([content], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 5000);
    }

    // Accent swap — quick fun toggle to change the accent palette
    accentBtn.addEventListener('click', () => {
      const root = document.documentElement;
      const a1 = getComputedStyle(root).getPropertyValue('--accent-1').trim();
      // quick rotate through a few palettes
      const palettes = [
        ['#7c3aed','#06b6d4','#60a5fa'],
        ['#fb7185','#f97316','#f59e0b'],
        ['#10b981','#06b6d4','#34d399'],
        ['#ef4444','#f43f5e','#fb7185']
      ];
      // find current index
      let idx = palettes.findIndex(p => p[0] === a1);
      idx = (idx + 1) % palettes.length;
      root.style.setProperty('--accent-1', palettes[idx][0]);
      root.style.setProperty('--accent-2', palettes[idx][1]);
      root.style.setProperty('--accent-3', palettes[idx][2]);
    });

    // cleanup URL objects on unload
    window.addEventListener('beforeunload', () => {
      if (previewFrame._lastBuild && previewFrame._lastBuild.url) {
        try { URL.revokeObjectURL(previewFrame._lastBuild.url); } catch(e){}
      }
    });

    // init
    updateFileLists();
  </script>
</body>
</html>
